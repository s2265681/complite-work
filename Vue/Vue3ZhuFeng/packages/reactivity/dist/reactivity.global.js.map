{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { reactive } from \"./reactive\";\nexport { effect } from \"./effect\";\n", "// src/index.ts\n/**\n * \u5224\u65AD\u5BF9\u8C61\n */\nexport const isObject = (value) => {\n  return typeof value === \"object\" && value !== null;\n};\n/**\n * \u5224\u65AD\u51FD\u6570\n */\nexport const isFunction = (value) => {\n  return typeof value === \"function\";\n};\n/**\n * \u5224\u65AD\u5B57\u7B26\u4E32\n */\nexport const isString = (value) => {\n  return typeof value === \"string\";\n};\n/**\n * \u5224\u65AD\u6570\u5B57\n */\nexport const isNumber = (value) => {\n  return typeof value === \"number\";\n};\n/**\n * \u5224\u65AD\u6570\u7EC4\n */\nexport const isArray = Array.isArray;\n", "export let activeEffect;\n\n// \u521D\u59CB\u5316\u65F6\u6267\u884C\u4E00\u6B21\uFF0C \u5E76\u4FDD\u5B58\u4E0B\u6765\nexport function effect(fn, options: any = {}) {\n  const _effect = new ReactiveEffect(fn);\n  _effect.run();\n}\n\nclass ReactiveEffect {\n  fn: any;\n  constructor(fn) {\n    this.fn = fn;\n  }\n  run() {\n    // \u5C06 _effect \u8D4B\u7ED9\u5168\u5C40\u7684\u53D8\u91CF activeEffect\n    activeEffect = this;\n    // fn\u6267\u884C\u65F6\uFF0C\u5185\u90E8\u7528\u5230\u7684\u54CD\u5E94\u5F0F\u6570\u636E\u7684\u5C5E\u6027\u4F1A\u88AB\u8BBF\u95EE\u5230\uFF0C\u5C31\u80FD\u89E6\u53D1 proxy \u5BF9\u8C61\u7684 get \u53D6\u503C\u64CD\u4F5C\n    this.fn();\n  }\n}\n\n// \u4F9D\u8D56\u6536\u96C6\n// \u5B58\u50A8\u6240\u6709\u7684\u4F9D\u8D56\u4FE1\u606F\uFF0C\u5305\u542B target\u3001key \u548C _effect\nconst targetMap = new WeakMap();\n/**\n * \u4F9D\u8D56\u6536\u96C6\u3002\u5173\u8054\u5BF9\u8C61\u3001\u5C5E\u6027\u548C _effect\u3002\n */\nexport function track(target, key) {\n  if (!activeEffect) return; // \u4ECE\u7F13\u5B58\u4E2D\u627E\u5230 target \u5BF9\u8C61\u6240\u6709\u7684\u4F9D\u8D56\u4FE1\u606F\n\n  let depsMap = targetMap.get(target);\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()));\n  } // \u518D\u627E\u5230\u5C5E\u6027 key \u6240\u5BF9\u5E94\u7684 _effect\u96C6\u5408\n  let deps = depsMap.get(key);\n  if (!deps) {\n    depsMap.set(key, (deps = new Set()));\n  } // \u5982\u679C _effect \u5DF2\u7ECF\u88AB\u6536\u96C6\u8FC7\u4E86\uFF0C\u5219\u4E0D\u518D\u6536\u96C6\n  let shouldTrack = !deps.has(activeEffect);\n  if (shouldTrack) {\n    deps.add(activeEffect);\n  }\n}\n\nexport function trigger(target, key) {\n  // \u4ECE\u7F13\u5B58\u4E2D\u627E\u5230 target \u5BF9\u8C61\u6240\u6709\u7684\u4F9D\u8D56\u4FE1\u606F\n  const depsMap = targetMap.get(target);\n  if (!depsMap) return;\n  // \u518D\u627E\u5230\u5C5E\u6027 key \u6240\u5BF9\u5E94\u7684 _effect\u96C6\u5408\n  const effects = depsMap.get(key);\n  if (!effects) return;\n  console.log(effects, \"effects\");\n  // \u5982\u679C _effect \u5DF2\u7ECF\u88AB\u6536\u96C6\u8FC7\u4E86\uFF0C\u5219\u4E0D\u518D\u6536\u96C6\n  effects.forEach((effect) => {\n    console.log(effect.run, \"fn\");\n    effect.run();\n  });\n}\n", "import { isObject } from \"@my-vue/shared\";\nimport { track, trigger } from \"./effect\";\n// 1. \u4EE3\u7406\u5BF9\u8C61 \u4EE3\u7406\u4E00\u6B21\u5C31\u53EF\u4EE5\u4E86\n// 2. \u4EE3\u7406\u5BF9\u8C61\u4E2D\u7684\u67D0\u4E2A\u5C5E\u6027\u518D\u6B21\u88AB\u4EE3\u7406\uFF0C\u4F1A\u9020\u6210\u6027\u80FD\u95EE\u9898\n\n// \u7F13\u5B58\u54CD\u5E94\u5F0F\u5BF9\u8C61\n// const reactiveMap = new WeakMap();\nconst enum ReactiveFlags {\n  IS_REACTIVE = \"__v_isReactive\",\n}\nexport function reactive(target) {\n  // \u53EA\u80FD\u4EE3\u7406\u5BF9\u8C61\n  if (!isObject(target)) {\n    return target;\n  }\n\n  // \u5224\u65AD target \u662F\u5426\u88AB\u4EE3\u7406\u8FC7\u3002\u5982\u679C\u88AB\u4EE3\u7406\u8FC7\uFF0C\u5219\u76F4\u63A5\u8FD4\u56DE\u4EE3\u7406\u5BF9\u8C61\n  // const existing = reactiveMap.get(target);\n  // if (existing) {\n  //   return existing;\n  // }\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n\n  const handler = {\n    // \u76D1\u542C\u5C5E\u6027\u8BBF\u95EE\u64CD\u4F5C\n    get(target, key, receiver) {\n      // \u8BBF\u95EE\u5230 __v_isReactive \u5C5E\u6027\u65F6\uFF0C\u8BF4\u660E\u6B64\u65F6\u7684 target \u5176\u5B9E\u662F\u4E00\u4E2A proxy \u5BF9\u8C61\uFF0C\u65E0\u9700\u518D\u88AB\u4EE3\u7406\n      if (key === ReactiveFlags.IS_REACTIVE) {\n        return true;\n      }\n      console.log(`${key}\u5C5E\u6027\u88AB\u8BBF\u95EE\uFF0C\u4F9D\u8D56\u6536\u96C6`);\n      debugger;\n      // \u4F9D\u8D56\u6536\u96C6\uFF0C\u8BA9 target, key \u548C \u5F53\u524D\u7684 _effect \u5173\u8054\u8D77\u6765\n      track(target, key);\n      const res = Reflect.get(target, key);\n      if (isObject(res)) {\n        return reactive(res);\n      }\n      return res;\n    }, // \u76D1\u542C\u8BBE\u7F6E\u5C5E\u6027\u64CD\u4F5C\n    set(target, key, value, receiver) {\n      console.log(`${key}\u5C5E\u6027\u53D8\u5316\u4E86\uFF0C\u6D3E\u53D1\u66F4\u65B0`); // \u5F53\u5C5E\u6027\u7684\u65B0\u503C\u548C\u65E7\u503C\u4E0D\u540C\u65F6\uFF0C\u518D\u8FDB\u884C\u8BBE\u7F6E\n      if (target[key] !== value) {\n        debugger;\n        const result = Reflect.set(target, key, value, receiver);\n        // \u6D3E\u53D1\u66F4\u65B0\uFF0C\u901A\u77E5 target \u7684\u5C5E\u6027\uFF0C\u8BA9\u4F9D\u8D56\u5B83\u7684 _effect \u518D\u6B21\u6267\u884C\n        trigger(target, key);\n        return result;\n      }\n    },\n  }; // \u5B9E\u4F8B\u5316\u4EE3\u7406\u5BF9\u8C61\n  const proxy = new Proxy(target, handler);\n\n  // \u5C06\u4EE3\u7406\u5BF9\u8C61\u8FDB\u884C\u7F13\u5B58\n  // reactiveMap.set(target, proxy);\n  return proxy;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACIO,MAAM,WAAW,CAAC,UAAU;AACjC,WAAO,OAAO,UAAU,YAAY,UAAU;AAAA,EAChD;AAsBO,MAAM,UAAU,MAAM;;;AC5BtB,MAAI;AAGJ,WAAS,OAAO,IAAI,UAAe,CAAC,GAAG;AAC5C,UAAM,UAAU,IAAI,eAAe,EAAE;AACrC,YAAQ,IAAI;AAAA,EACd;AAEA,MAAM,iBAAN,MAAqB;AAAA,IAEnB,YAAY,IAAI;AACd,WAAK,KAAK;AAAA,IACZ;AAAA,IACA,MAAM;AAEJ,qBAAe;AAEf,WAAK,GAAG;AAAA,IACV;AAAA,EACF;AAIA,MAAM,YAAY,oBAAI,QAAQ;AAIvB,WAAS,MAAM,QAAQ,KAAK;AACjC,QAAI,CAAC;AAAc;AAEnB,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACZ,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC7C;AACA,QAAI,OAAO,QAAQ,IAAI,GAAG;AAC1B,QAAI,CAAC,MAAM;AACT,cAAQ,IAAI,KAAM,OAAO,oBAAI,IAAI,CAAE;AAAA,IACrC;AACA,QAAI,cAAc,CAAC,KAAK,IAAI,YAAY;AACxC,QAAI,aAAa;AACf,WAAK,IAAI,YAAY;AAAA,IACvB;AAAA,EACF;AAEO,WAAS,QAAQ,QAAQ,KAAK;AAEnC,UAAM,UAAU,UAAU,IAAI,MAAM;AACpC,QAAI,CAAC;AAAS;AAEd,UAAM,UAAU,QAAQ,IAAI,GAAG;AAC/B,QAAI,CAAC;AAAS;AACd,YAAQ,IAAI,SAAS,SAAS;AAE9B,YAAQ,QAAQ,CAACA,YAAW;AAC1B,cAAQ,IAAIA,QAAO,KAAK,IAAI;AAC5B,MAAAA,QAAO,IAAI;AAAA,IACb,CAAC;AAAA,EACH;;;AC/CO,WAAS,SAAS,QAAQ;AAE/B,QAAI,CAAC,SAAS,MAAM,GAAG;AACrB,aAAO;AAAA,IACT;AAOA,QAAI,OAAO,kCAAyB,GAAG;AACrC,aAAO;AAAA,IACT;AAEA,UAAM,UAAU;AAAA;AAAA,MAEd,IAAIC,SAAQ,KAAK,UAAU;AAEzB,YAAI,QAAQ,oCAA2B;AACrC,iBAAO;AAAA,QACT;AACA,gBAAQ,IAAI,GAAG,iEAAe;AAC9B;AAEA,cAAMA,SAAQ,GAAG;AACjB,cAAM,MAAM,QAAQ,IAAIA,SAAQ,GAAG;AACnC,YAAI,SAAS,GAAG,GAAG;AACjB,iBAAO,SAAS,GAAG;AAAA,QACrB;AACA,eAAO;AAAA,MACT;AAAA;AAAA,MACA,IAAIA,SAAQ,KAAK,OAAO,UAAU;AAChC,gBAAQ,IAAI,GAAG,iEAAe;AAC9B,YAAIA,QAAO,GAAG,MAAM,OAAO;AACzB;AACA,gBAAM,SAAS,QAAQ,IAAIA,SAAQ,KAAK,OAAO,QAAQ;AAEvD,kBAAQA,SAAQ,GAAG;AACnB,iBAAO;AAAA,QACT;AAAA,MACF;AAAA,IACF;AACA,UAAM,QAAQ,IAAI,MAAM,QAAQ,OAAO;AAIvC,WAAO;AAAA,EACT;",
  "names": ["effect", "target"]
}
